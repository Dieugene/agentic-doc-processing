# Отчет о реализации: Converter (DOCX/Excel/TXT → PDF)

## Что реализовано

Модуль конвертации документов (DOCX, Excel, TXT) в унифицированный PDF формат для последующего рендеринга в PNG. Поддерживает auto-detection по расширению, обработку ошибок, логирование и multi-sheet Excel (каждый лист = страница).

## Файлы

**Новые:**
- `02_src/processing/__init__.py` - экспорт модуля processing
- `02_src/processing/converter.py` - FileType enum, ConversionError, Converter класс
- `02_src/processing/tests/__init__.py` - пакет тестов
- `02_src/processing/tests/test_converter.py` - unit тесты
- `02_src/processing/tests/fixtures/sample.txt` - тестовый TXT файл
- `02_src/processing/tests/fixtures/create_fixtures.py` - скрипт генерации fixture'ов (DOCX, XLSX)
- `requirements.txt` - зависимости проекта
- `04_logs/converter/` - директория для логов конвертации

**Измененные:**
- Нет

## Особенности реализации

### Очистка временных файлов
**Причина:** Согласно ТЗ (analysis_01.md раздел 3.7), ответственность за очистку временных PDF на вызывающей стороне (Renderer).
**Решение:** Converter использует `tempfile.NamedTemporaryFile(delete=False)` и возвращает путь к PDF. Вызывающий код должен удалить файл после использования.

### Обработка кодировок TXT
**Причина:** TXT файлы могут быть в UTF-8 или CP1251 (Windows), нужна авто-детекция.
**Решение:** Реализован метод `_read_text_file()` с каскадом: UTF-8 → chardet → CP1251 → latin-1 (fallback).

### Форматирование DOCX
**Причина:** python-docx не поддерживает полное сохранение стилей и изображений (ограничение библиотеки).
**Решение:** Для v1.0 реализовано сохранение параграфов, bold/italic, размера шрифта. Изображения игнорируются (допустимо для v1.0).

### Multi-sheet Excel
**Причина:** Каждый лист Excel должен быть отдельной страницей PDF с заголовком (ТЗ).
**Решение:** Реализован проход по всем листам, каждый добавляет новую страницу с заголовком "Sheet: {name}".

## Известные проблемы

### Ограничение кириллицы в PDF
**Проблема:** fpdf2 с базовыми шрифтами (Arial, Times) имеет ограниченную поддержку кириллицы. Символы могут отображаться некорректно.
**Влияние:** Текст конвертируется, но кириллица может быть заменена на '?' или другие символы.
**Рекомендация:** Для production использовать TrueType шрифты с поддержкой кириллицы (требует настройки fpdf2).

### DOCX форматирование
**Проблема:** python-docx теряет часть форматирования (позиционирование, отступы, цвета).
**Влияние:** Конвертированный PDF сохраняет базовую структуру, но визуально может отличаться от оригинала.
**Статус:** Допустимо для v1.0 согласно ТЗ.

### Изображения в DOCX
**Проблема:** Изображения в DOCX файлах не извлекаются и не добавляются в PDF.
**Статус:** Допустимо для v1.0 согласно ТЗ (analysis_01.md раздел 6).

## Тестирование

Для запуска тестов необходимо:

1. Установить зависимости:
```bash
pip install -r requirements.txt
```

2. Создать fixture файлы:
```bash
python -m processing.tests.fixtures.create_fixtures
```

3. Запустить тесты:
```bash
pytest -v 02_src/processing/tests/test_converter.py
```

## Зависимости

Добавлены в `requirements.txt`:
- `python-docx>=1.0.0` - чтение DOCX файлов
- `openpyxl>=3.1.0` - чтение Excel файлов
- `fpdf2>=2.7.0` - генерация PDF
- `chardet>=5.0.0` - авто-детекция кодировки TXT
- `pytest>=7.0.0` - тестирование
- `pytest-asyncio>=0.21.0` - async тесты
